<!DOCTYPE html>
<html>
<head>
  <title>AI Command Center ‚Äì Karnataka 2080</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="dark">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.0.1/leaflet-heat.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #8b5cf6;
      --primary-light: #a78bfa;
      --secondary: #60a5fa;
      --accent: #34d399;
      --text-primary: #e0e7ff;
      --text-secondary: #94a3b8;
      --glow: rgba(139, 92, 246, 0.5);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1729 100%);
      color: var(--text-primary);
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Preloader */
    .preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeOut 0.8s ease-out 2.5s forwards;
    }

    .loader {
      width: 60px;
      height: 60px;
      border: 2px solid rgba(139, 92, 246, 0.2);
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    /* Background Effects */
    .neural-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(90deg, rgba(139, 92, 246, 0.03) 1px, transparent 1px),
        linear-gradient(rgba(139, 92, 246, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      z-index: 1;
      pointer-events: none;
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: radial-gradient(circle, var(--primary), rgba(139, 92, 246, 0.1));
      border-radius: 50%;
      animation: float linear infinite;
      box-shadow: 0 0 10px var(--glow);
    }

    @keyframes float {
      to {
        transform: translateY(-100vh) translateX(var(--tx));
        opacity: 0;
      }
    }

    /* Main Container */
    .container-2080 {
      position: relative;
      z-index: 10;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header Hero */
    .header-hero {
      padding: 80px 40px 60px;
      text-align: center;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(139, 92, 246, 0.15);
      animation: slideDown 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header-hero h1 {
      font-size: 56px;
      font-weight: 800;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #a78bfa, #60a5fa, #34d399);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -1.5px;
    }

    .header-hero p {
      font-size: 16px;
      color: #a0aec0;
      margin-bottom: 40px;
      font-weight: 500;
    }

    /* Search Container */
    .search-container {
      max-width: 650px;
      margin: 0 auto 50px;
      position: relative;
      z-index: 20;
    }

    .search-wrapper {
      position: relative;
      display: flex;
      gap: 10px;
    }

    .ai-search {
      flex: 1;
      padding: 16px 24px;
      background: rgba(30, 41, 59, 0.7);
      border: 1.5px solid rgba(139, 92, 246, 0.3);
      border-radius: 16px;
      color: var(--text-primary);
      font-size: 15px;
      backdrop-filter: blur(10px);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      outline: none;
      font-weight: 500;
    }

    .ai-search:focus {
      background: rgba(30, 41, 59, 0.95);
      border-color: var(--primary);
      box-shadow: 0 0 35px var(--glow), inset 0 0 25px rgba(139, 92, 246, 0.15);
      transform: translateY(-3px);
    }

    .ai-search::placeholder {
      color: #64748b;
    }

    /* Autocomplete */
    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(30, 41, 59, 0.98);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 16px;
      margin-top: 10px;
      backdrop-filter: blur(15px);
      max-height: 420px;
      overflow-y: auto;
      display: none;
      z-index: 30;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
      animation: slideDown 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .autocomplete-list.show {
      display: block;
    }

    .autocomplete-item {
      padding: 14px 18px;
      cursor: pointer;
      transition: all 0.2s ease;
      border-bottom: 1px solid rgba(139, 92, 246, 0.1);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .autocomplete-item:hover {
      background: rgba(139, 92, 246, 0.15);
      padding-left: 24px;
    }

    .autocomplete-item:last-child {
      border-bottom: none;
    }

    .autocomplete-item span:first-child {
      color: var(--primary-light);
      font-weight: 600;
      flex: 1;
    }

    .autocomplete-item span:last-child {
      color: #64748b;
      font-size: 12px;
      background: rgba(139, 92, 246, 0.1);
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: 600;
    }

    /* Recommended Section */
    .recommended-section {
      padding: 60px 40px;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    .section-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 40px;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .cities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 28px;
      margin-bottom: 60px;
    }

    .city-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(30, 27, 59, 0.4));
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 20px;
      padding: 28px;
      cursor: pointer;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .city-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(139, 92, 246, 0.15), transparent);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .city-card:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(80, 120, 200, 0.12));
      border-color: rgba(139, 92, 246, 0.4);
      box-shadow: 0 15px 50px rgba(139, 92, 246, 0.35), inset 0 1px 1px rgba(255, 255, 255, 0.1);
      transform: translateY(-6px);
    }

    .city-card:hover::before {
      opacity: 1;
    }

    .city-name {
      font-size: 22px;
      font-weight: 800;
      margin-bottom: 8px;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }

    .city-aqi {
      font-size: 13px;
      color: #94a3b8;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .score-circle {
      width: 100px;
      height: 100px;
      margin: 20px auto;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .score-circle svg {
      transform: rotateZ(-90deg);
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 0 25px rgba(139, 92, 246, 0.4));
    }

    .score-text {
      position: absolute;
      text-align: center;
    }

    .score-value {
      font-size: 32px;
      font-weight: 800;
      color: var(--primary-light);
    }

    .score-label {
      font-size: 11px;
      color: #64748b;
      margin-top: 2px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 700;
    }

    .card-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .card-actions a {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      text-align: center;
      text-decoration: none;
      font-size: 13px;
      font-weight: 700;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 1.5px solid rgba(139, 92, 246, 0.25);
      color: var(--primary-light);
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .card-actions a:hover {
      background: rgba(139, 92, 246, 0.15);
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2);
    }

    /* Map & Sidebar Layout */
    .map-layout {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 28px;
      padding: 0 40px 60px;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
      align-items: start;
    }

    .map-section {
      position: relative;
    }

    .map-container {
      background: rgba(15, 23, 41, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 20px;
      overflow: hidden;
      height: 550px;
      backdrop-filter: blur(10px);
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
      position: relative;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    /* Rankings Sidebar */
    .ranking-sidebar {
      height: fit-content;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.75), rgba(30, 27, 59, 0.55));
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 20px;
      padding: 28px;
      backdrop-filter: blur(15px);
      box-shadow: 0 15px 50px rgba(139, 92, 246, 0.2);
    }

    .ranking-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 24px;
      font-weight: 800;
      color: var(--text-primary);
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .ranking-badge {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 10px;
      color: white;
      font-weight: 800;
      animation: pulse 1.5s ease-in-out infinite;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .ranking-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .rank-item {
      padding: 16px;
      background: rgba(15, 23, 41, 0.6);
      border: 1px solid rgba(139, 92, 246, 0.15);
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .rank-item:hover {
      background: rgba(139, 92, 246, 0.12);
      border-color: rgba(139, 92, 246, 0.3);
      transform: translateX(4px);
      box-shadow: 0 8px 25px rgba(139, 92, 246, 0.2);
    }

    .rank-city {
      font-weight: 800;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 6px;
    }

    .rank-info {
      font-size: 12px;
      color: #94a3b8;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .rank-score {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 3px 9px;
      border-radius: 6px;
      font-weight: 800;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Admin Button */
    .admin-btn {
      position: fixed;
      bottom: 40px;
      right: 40px;
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 28px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 15px 50px rgba(139, 92, 246, 0.4);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 100;
      text-decoration: none;
    }

    .admin-btn:hover {
      transform: scale(1.15) rotateZ(15deg);
      box-shadow: 0 20px 60px rgba(139, 92, 246, 0.6);
    }

    .admin-btn:active {
      transform: scale(0.95);
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .header-hero {
        padding: 60px 30px 50px;
      }

      .header-hero h1 {
        font-size: 44px;
      }

      .recommended-section {
        padding: 50px 30px;
      }

      .map-layout {
        grid-template-columns: 1fr;
        padding: 0 30px 50px;
      }

      .ranking-sidebar {
        max-width: 360px;
      }
    }

    @media (max-width: 768px) {
      .header-hero {
        padding: 50px 20px 40px;
      }

      .header-hero h1 {
        font-size: 32px;
      }

      .header-hero p {
        margin-bottom: 30px;
      }

      .cities-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .search-container {
        padding: 0 20px;
      }

      .recommended-section {
        padding: 40px 20px;
      }

      .map-container {
        height: 400px;
      }

      .admin-btn {
        width: 60px;
        height: 60px;
        font-size: 24px;
        bottom: 30px;
        right: 30px;
      }
    }

    @media (max-width: 480px) {
      .header-hero h1 {
        font-size: 28px;
        margin-bottom: 8px;
      }

      .header-hero {
        padding: 40px 16px 30px;
      }

      .recommended-section {
        padding: 30px 16px;
      }

      .map-layout {
        padding: 0 16px 40px;
      }

      .search-container {
        padding: 0;
      }

      .ai-search {
        padding: 14px 18px;
        font-size: 14px;
      }

      .ranking-sidebar {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div class="preloader">
    <div class="loader"></div>
  </div>

  <div class="neural-grid"></div>
  <div class="particles"></div>

  <div class="container-2080">
    <!-- Header -->
    <div class="header-hero">
      <h1>‚ö° AI COMMAND CENTER</h1>
      <p>Karnataka Real-Time Liveability Intelligence Network</p>

      <!-- Search -->
      <div class="search-container">
        <div class="search-wrapper">
          <input 
            type="text" 
            class="ai-search" 
            id="citySearch" 
            placeholder="üîç Search cities... (e.g., Bengaluru, Mysuru)"
            autocomplete="off"
          >
        </div>
        <div class="autocomplete-list" id="autocompleteList"></div>
      </div>
    </div>

    <!-- Featured Cities -->
    <div class="recommended-section">
      <div class="section-title">üåü Featured Cities</div>
      <div class="cities-grid" id="recommendedCities"></div>
    </div>

    <!-- Map & Rankings -->
    <div class="map-layout">
      <div class="map-section">
        <div class="map-container">
          <div id="map"></div>
        </div>
      </div>

      <div class="ranking-sidebar">
        <div class="ranking-header">
          üèÜ TOP CITIES
          <span class="ranking-badge">LIVE</span>
        </div>
        <div class="ranking-list" id="ranked"></div>
      </div>
    </div>
  </div>

  <a href="/admin" class="admin-btn" title="Admin Dashboard">‚öôÔ∏è</a>

<script>
  // PARTICLES
  function createParticles() {
    const container = document.querySelector('.particles');
    const colors = ['#8b5cf6', '#60a5fa', '#34d399', '#fbbf24'];
    
    for (let i = 0; i < 45; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * window.innerHeight;
      const size = Math.random() * 4 + 1.5;
      const duration = Math.random() * 22 + 18;
      const tx = (Math.random() - 0.5) * 120;
      
      particle.style.cssText = `
        left: ${x}px;
        top: ${y}px;
        width: ${size}px;
        height: ${size}px;
        --tx: ${tx}px;
        animation-duration: ${duration}s;
        animation-delay: ${Math.random() * 6}s;
        background: radial-gradient(circle, ${colors[Math.floor(Math.random() * colors.length)]}, rgba(139, 92, 246, 0.1));
      `;
      container.appendChild(particle);
    }
  }

  createParticles();

  // MAP
  const map = L.map('map').setView([15.3173, 75.7139], 7);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap',
    maxZoom: 19
  }).addTo(map);

  const cities = {{ cities|tojson }};
  const icon = L.icon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
    iconSize: [28, 28],
    iconAnchor: [14, 14]
  });

  let heatData = { ranked: [], points: [] };
  let heatLayer = null;

  async function loadHeatData() {
    try {
      const res = await fetch("/api/heat");
      heatData = await res.json();

      if (heatLayer) map.removeLayer(heatLayer);
      heatLayer = L.heatLayer(heatData.points, {
        radius: 35,
        blur: 25,
        maxZoom: 9,
        gradient: { 0.2: '#00ff00', 0.4: '#ffff00', 0.6: '#ff7700', 1.0: '#ff0000' }
      }).addTo(map);

      updateRankings();
      updateRecommendedCities();
    } catch (e) {
      console.error('Error:', e);
    }
  }

  // Markers
  for (const city in cities) {
    const c = cities[city];
    const marker = L.marker([c.lat, c.lon], { icon }).addTo(map);
    
    marker.bindPopup(`
      <div style="
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.98), rgba(30, 27, 59, 0.95));
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 14px;
        padding: 18px;
        min-width: 260px;
        color: #e0e7ff;
        font-family: -apple-system, BlinkMacSystemFont;
      ">
        <div style="
          font-weight: 800;
          font-size: 18px;
          margin-bottom: 14px;
          color: #a78bfa;
        ">${city}</div>

        <a href="/view/${city}" 
           style="
              display: block;
              text-align: center;
              background: linear-gradient(135deg, #8b5cf6, #60a5fa);
              color: white;
              padding: 12px;
              border-radius: 10px;
              text-decoration: none;
              margin-bottom: 10px;
              font-weight: 700;
              transition: all 0.3s ease;
              border: none;
              cursor: pointer;
              font-size: 13px;
              text-transform: uppercase;
              letter-spacing: 0.8px;
           "
           onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(139, 92, 246, 0.4)'"
           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
        >üìä View Details</a>

        <a href="/feedback/${city}" 
           style="
              display: block;
              text-align: center;
              background: transparent;
              color: #34d399;
              padding: 12px;
              border-radius: 10px;
              border: 1.5px solid #34d399;
              text-decoration: none;
              font-weight: 700;
              transition: all 0.3s ease;
              cursor: pointer;
              font-size: 13px;
              text-transform: uppercase;
              letter-spacing: 0.8px;
           "
           onmouseover="this.style.background='rgba(52, 211, 153, 0.12)'; this.style.transform='translateY(-2px)'"
           onmouseout="this.style.background='transparent'; this.style.transform='translateY(0)'"
        >‚≠ê Give Feedback</a>
      </div>
    `);
  }

  // AUTOCOMPLETE
  const searchInput = document.getElementById('citySearch');
  const autocompleteList = document.getElementById('autocompleteList');
  let currentIndex = -1;

  searchInput.addEventListener('input', (e) => {
    const val = e.target.value.toLowerCase().trim();
    currentIndex = -1;

    if (!val) {
      autocompleteList.classList.remove('show');
      return;
    }

    const matches = Object.keys(cities).filter(c => 
      c.toLowerCase().includes(val)
    ).slice(0, 10);

    if (matches.length === 0) {
      autocompleteList.classList.remove('show');
      return;
    }

    autocompleteList.innerHTML = matches.map((city) => `
      <div class="autocomplete-item" data-city="${city}">
        <span>üìç ${city}</span>
        <span>${Math.random() * 40 + 50 | 0}</span>
      </div>
    `).join('');

    autocompleteList.classList.add('show');

    document.querySelectorAll('.autocomplete-item').forEach((item) => {
      item.addEventListener('click', () => selectCity(item.dataset.city));
    });
  });

  searchInput.addEventListener('keydown', (e) => {
    const items = document.querySelectorAll('.autocomplete-item');
    
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      currentIndex = Math.min(currentIndex + 1, items.length - 1);
      items[currentIndex]?.scrollIntoView({ block: 'nearest' });
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      currentIndex = Math.max(currentIndex - 1, 0);
      items[currentIndex]?.scrollIntoView({ block: 'nearest' });
    } else if (e.key === 'Enter') {
      e.preventDefault();
      if (currentIndex >= 0 && items[currentIndex]) {
        selectCity(items[currentIndex].dataset.city);
      }
    } else if (e.key === 'Escape') {
      autocompleteList.classList.remove('show');
    }
  });

  function selectCity(cityName) {
    searchInput.value = cityName;
    autocompleteList.classList.remove('show');
    
    const c = cities[cityName];
    if (c) {
      map.flyTo([c.lat, c.lon], 10, { duration: 1.5 });
    }
  }

  // RANKINGS
  function updateRankings() {
    const rankDiv = document.getElementById('ranked');
    rankDiv.innerHTML = heatData.ranked.slice(0, 8).map((r, idx) => `
      <div class="rank-item" onclick="selectCity('${r.city}')">
        <div class="rank-city">#${idx + 1} ${r.city}</div>
        <div class="rank-info">
          <span>Score <span class="rank-score">${r.score}</span></span>
        </div>
      </div>
    `).join('');
  }

  // RECOMMENDED CITIES
  function updateRecommendedCities() {
    const grid = document.getElementById('recommendedCities');
    const topCities = heatData.ranked.slice(0, 6);

    grid.innerHTML = topCities.map(r => {
      const percentage = r.score;
      const circumference = 2 * Math.PI * 40;
      const strokeDashoffset = circumference - (percentage / 100) * circumference;

      return `
        <div class="city-card" onclick="selectCity('${r.city}')">
          <div class="city-name">${r.city}</div>
          <div class="city-aqi">${r.aqi !== null ? `AQI: ${r.aqi}` : 'AQI: ‚Äî'} ‚Ä¢ Live</div>

          <div class="score-circle">
            <svg viewBox="0 0 100 100" width="100" height="100">
              <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(139, 92, 246, 0.1)" stroke-width="4"/>
              <circle cx="50" cy="50" r="40" fill="none" stroke="url(#scoreGrad)" stroke-width="4" 
                      stroke-dasharray="${circumference}" stroke-dashoffset="${strokeDashoffset}"
                      stroke-linecap="round" style="transition: stroke-dashoffset 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);"/>
              <defs>
                <linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#a78bfa"/>
                  <stop offset="50%" stop-color="#60a5fa"/>
                  <stop offset="100%" stop-color="#34d399"/>
                </linearGradient>
              </defs>
            </svg>
            <div class="score-text">
              <div class="score-value">${r.score}</div>
              <div class="score-label">Score</div>
            </div>
          </div>

          <div class="card-actions">
            <a href="/view/${r.city}">üìä Details</a>
            <a href="/feedback/${r.city}">‚≠ê Rate</a>
          </div>
        </div>
      `;
    }).join('');
  }

  // INITIALIZE
  loadHeatData();
  setInterval(loadHeatData, 120000);
</script>

</body>
</html>
